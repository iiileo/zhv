#!/bin/bash

# æµ‹è¯•æž„å»ºè„šæœ¬
# ç”¨äºŽéªŒè¯GitHub Actionså·¥ä½œæµçš„æœ¬åœ°æµ‹è¯•

set -e

echo "ðŸ”§ å¼€å§‹æµ‹è¯•æž„å»ºæµç¨‹..."

# æ£€æŸ¥GoçŽ¯å¢ƒ
echo "ðŸ“‹ æ£€æŸ¥çŽ¯å¢ƒ..."
echo "Goç‰ˆæœ¬: $(go version)"
echo "å½“å‰ç›®å½•: $(pwd)"

# æ¸…ç†ä¹‹å‰çš„æž„å»º
echo "ðŸ§¹ æ¸…ç†ä¹‹å‰çš„æž„å»ºæ–‡ä»¶..."
make clean

# æµ‹è¯•åŸºæœ¬æž„å»º
echo "ðŸ”¨ æµ‹è¯•åŸºæœ¬æž„å»º..."
make build

# æµ‹è¯•ç‰ˆæœ¬å‘½ä»¤
echo "ðŸ“ æµ‹è¯•ç‰ˆæœ¬å‘½ä»¤..."
./zhv version
echo ""

# æµ‹è¯•å¸®åŠ©å‘½ä»¤
echo "â“ æµ‹è¯•å¸®åŠ©å‘½ä»¤..."
./zhv --help
echo ""

# æµ‹è¯•é…ç½®å‘½ä»¤
echo "âš™ï¸ æµ‹è¯•é…ç½®å‘½ä»¤..."
./zhv config show || echo "é…ç½®æ˜¾ç¤ºæ­£å¸¸ï¼ˆå¯èƒ½æœªé…ç½®ï¼‰"
echo ""

# æµ‹è¯•è·¨å¹³å°æž„å»ºï¼ˆå¦‚æžœmake build-allå¯ç”¨ï¼‰
echo "ðŸŒ æµ‹è¯•è·¨å¹³å°æž„å»º..."
if make build-all; then
    echo "âœ… è·¨å¹³å°æž„å»ºæˆåŠŸ"
    echo "ðŸ“¦ ç”Ÿæˆçš„æ–‡ä»¶ï¼š"
    ls -la zhv-* 2>/dev/null || echo "æ²¡æœ‰æ‰¾åˆ°è·¨å¹³å°æž„å»ºæ–‡ä»¶"
else
    echo "âš ï¸ è·¨å¹³å°æž„å»ºå¤±è´¥æˆ–ä¸å¯ç”¨"
fi

echo ""
echo "ðŸŽ‰ æž„å»ºæµ‹è¯•å®Œæˆï¼"
echo ""
echo "ðŸ“ å½“å‰ç›®å½•æ–‡ä»¶ï¼š"
ls -la zhv* 2>/dev/null || echo "æ²¡æœ‰æ‰¾åˆ°æž„å»ºæ–‡ä»¶"
